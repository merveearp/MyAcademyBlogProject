@model List<ResultContactMessageDto>
@{
    ViewData["Title"] = "İletişim Mesajları";
    Layout = "~/Areas/Admin/Views/Admin/AdminLayout.cshtml";
    int count = 0;
}

<!-- Contact Messages Table Start -->
<div class="pd-20 card-box mb-30">
    <div class="clearfix mb-20">
        <div class="pull-left">
            <h2 class="text-blue h2">İletişim Mesajları</h2>
            <p class="mb-0 text-muted">Kullanıcılardan gelen mesajları yönetin</p>
        </div>
        <div class="pull-right">
            @if (Model != null && Model.Any())
            {
                <span class="badge badge-primary badge-pill" style="font-size: 14px; padding: 8px 15px;">
                    <i class="icon-copy dw dw-envelope"></i> @Model.Count Mesaj
                </span>
            }
        </div>
    </div>

    @if (Model != null && Model.Any())
    {
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="bg-light">
                    <tr>
                        <th scope="col" class="text-center" style="width: 5%;">#</th>
                        <th scope="col" style="width: 15%;">
                            <i class="icon-copy dw dw-user1"></i> Gönderen
                        </th>
                        <th scope="col" style="width: 18%;">
                            <i class="icon-copy dw dw-email"></i> E-posta
                        </th>
                        <th scope="col" style="width: 15%;">
                            <i class="icon-copy dw dw-tag"></i> Konu
                        </th>
                        <th scope="col" style="width: 32%;">
                            <i class="icon-copy dw dw-chat"></i> Mesaj
                        </th>
                        <th scope="col" class="text-center" style="width: 15%;">İşlemler</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        count++;
                        <tr>
                            <td class="text-center">
                                <span class="badge badge-pill badge-primary">@count</span>
                            </td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="avatar mr-2" style="width: 35px; height: 35px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                        @item.FullName.Substring(0, 1).ToUpper()
                                    </div>
                                    <div>
                                        <strong>@item.FullName</strong>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <a href="mailto:@item.Email" class="text-primary">
                                    <i class="icon-copy dw dw-email mr-1"></i>
                                    @item.Email
                                </a>
                            </td>
                            <td>
                                <span class="badge badge-info" style="white-space: normal; text-align: left;">
                                    @item.Subject
                                </span>
                            </td>
                            <td>
                                <div class="message-preview" style="max-height: 60px; overflow: hidden; text-overflow: ellipsis;">
                                    @if (item.Message.Length > 100)
                                    {
                                        <span>@item.Message.Substring(0, 100)...</span>
                                        <a href="#" data-toggle="modal" data-target="#messageModal@item.Id" class="text-primary">
                                            <small>Devamını Oku</small>
                                        </a>
                                    }
                                    else
                                    {
                                        <span>@item.Message</span>
                                    }
                                </div>
                            </td>
                            <td class="text-center">
                                <div class="btn-group" role="group">
                                    <a href="#"
                                       data-toggle="modal"
                                       data-target="#messageModal@item.Id"
                                       class="btn btn-info btn-sm"
                                       title="Görüntüle">
                                        <i class="icon-copy dw dw-eye"></i>
                                    </a>
                                    <a href="mailto:@item.Email"
                                       class="btn btn-success btn-sm"
                                       title="Yanıtla">
                                        <i class="icon-copy dw dw-reply"></i>
                                    </a>
                                    <a href="/Admin/ContactMessage/DeleteContactMessage/@item.Id"
                                       class="btn btn-danger btn-sm"
                                       onclick="return confirm('Bu mesajı silmek istediğinizden emin misiniz?');"
                                       title="Sil">
                                        <i class="icon-copy dw dw-delete-3"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>

                        <!-- Message Detail Modal -->
                        <div class="modal fade" id="messageModal@item.Id" tabindex="-1" role="dialog" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                                <div class="modal-content">
                                    <div class="modal-header bg-primary text-white">
                                        <h5 class="modal-title">
                                            <i class="icon-copy dw dw-envelope mr-2"></i>
                                            Mesaj Detayı
                                        </h5>
                                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <strong><i class="icon-copy dw dw-user1 mr-2 text-primary"></i>Gönderen:</strong>
                                                <p class="mb-0">@item.FullName</p>
                                            </div>
                                            <div class="col-md-6">
                                                <strong><i class="icon-copy dw dw-email mr-2 text-primary"></i>E-posta:</strong>
                                                <p class="mb-0">
                                                    <a href="mailto:@item.Email">@item.Email</a>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <strong><i class="icon-copy dw dw-tag mr-2 text-primary"></i>Konu:</strong>
                                            <p class="mb-0">@item.Subject</p>
                                        </div>
                                        <hr>
                                        <div>
                                            <strong><i class="icon-copy dw dw-chat mr-2 text-primary"></i>Mesaj:</strong>
                                            <div class="mt-2 p-3" style="background-color: #f8f9fa; border-radius: 8px; white-space: pre-wrap;">
                                                @item.Message
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <a href="mailto:@item.Email" class="btn btn-success">
                                            <i class="icon-copy dw dw-reply mr-2"></i>Yanıtla
                                        </a>
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Kapat</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="alert alert-info text-center" role="alert">
            <i class="icon-copy dw dw-inbox mr-2" style="font-size: 50px; display: block; margin-bottom: 15px;"></i>
            <h5>Henüz mesaj bulunmamaktadır</h5>
            <p class="mb-0">Kullanıcılar iletişim formunu kullandığında mesajlar burada görünecektir.</p>
        </div>
    }

    @if (Model != null && Model.Any())
    {
        <div class="mt-3">
            <small class="text-muted">
                <i class="icon-copy dw dw-info mr-1"></i>
                Toplam <strong>@Model.Count</strong> mesaj bulunmaktadır.
            </small>
        </div>
    }
</div>
<!-- Contact Messages Table End -->